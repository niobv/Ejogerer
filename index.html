<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>StreamFlix - Movies & Dramas</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
  /* Reset & base */
  *, *::before, *::after {
    box-sizing: border-box;
  }
  body {
    margin: 0;
    background: #141414;
    color: #fff;
    font-family: 'Montserrat', sans-serif;
    overflow-x: hidden;
  }
  a {
    text-decoration: none;
    color: inherit;
  }
  /* Login & Register Overlay */
  #login-overlay {
    position: fixed;
    inset: 0;
    background: #141414;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 3000;
    flex-direction: column;
    padding: 20px;
  }
  #login-box {
    background: #222;
    padding: 40px 35px;
    border-radius: 12px;
    box-shadow: 0 0 15px #e50914aa;
    width: 320px;
    max-width: 90vw;
    text-align: center;
  }
  #login-box h2 {
    margin: 0 0 20px;
    font-weight: 700;
    font-size: 1.8rem;
    color: #e50914;
    user-select: none;
  }
  #login-box input[type="text"],
  #login-box input[type="password"] {
    width: 100%;
    padding: 12px 14px;
    margin-bottom: 18px;
    border-radius: 25px;
    border: none;
    background: #333;
    color: #fff;
    font-size: 1rem;
  }
  #login-box input::placeholder {
    color: #aaa;
  }
  #login-box button {
    background: #e50914;
    color: #fff;
    border: none;
    padding: 12px 0;
    width: 100%;
    border-radius: 25px;
    font-size: 1.1rem;
    cursor: pointer;
    font-weight: 700;
    transition: background-color 0.3s ease;
  }
  #login-box button:hover {
    background-color: #b0070e;
  }
  #login-error {
    color: #ff5252;
    margin-top: 12px;
    min-height: 22px;
    font-weight: 600;
  }
  #toggle-form {
    margin-top: 14px;
    color: #aaa;
    font-size: 0.9rem;
    cursor: pointer;
    user-select: none;
  }
  #toggle-form:hover {
    color: #e50914;
  }
  /* Header */
  header {
    position: fixed;
    width: 100%;
    top: 0;
    left: 0;
    height: 70px;
    background: rgba(20, 20, 20, 0.95);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 30px;
    z-index: 1000;
    border-bottom: 1px solid #303030;
  }
  .logo {
    font-size: 1.8rem;
    font-weight: 900;
    letter-spacing: 3px;
    color: #e50914;
    user-select: none;
  }
  nav {
    display: flex;
    align-items: center;
  }
  nav a {
    margin-left: 25px;
    font-weight: 600;
    font-size: 0.95rem;
    transition: color 0.3s ease;
    cursor: pointer;
  }
  nav a:hover {
    color: #e50914;
  }
  /* Search */
  #search-container {
    margin-left: 25px;
    position: relative;
  }
  #search-input {
    background: #222;
    border: none;
    padding: 6px 10px;
    border-radius: 15px;
    color: #fff;
    width: 180px;
    font-size: 0.9rem;
    transition: width 0.3s ease;
  }
  #search-input:focus {
    outline: none;
    width: 250px;
  }
  /* Main sections */
  main {
    padding-top: 80px;
    max-width: 1400px;
    margin: 0 auto 40px;
  }
  .section-title {
    margin: 20px 30px 10px;
    font-size: 1.6rem;
    font-weight: 700;
    letter-spacing: 1.1px;
    user-select: none;
  }
  /* Rows with horizontal scrolling like Netflix */
  .movie-row {
    position: relative;
    margin: 0 30px 40px;
  }
  .movie-row .movie-cards {
    display: flex;
    overflow-x: auto;
    scroll-behavior: smooth;
    padding-bottom: 6px;
    scrollbar-width: thin;
    scrollbar-color: #555 transparent;
  }
  .movie-row .movie-cards::-webkit-scrollbar {
    height: 8px;
  }
  .movie-row .movie-cards::-webkit-scrollbar-thumb {
    background: #555;
    border-radius: 10px;
  }
  .movie-card {
    flex: 0 0 auto;
    width: 160px;
    margin-right: 12px;
    border-radius: 8px;
    background: #222;
    box-shadow: 0 3px 8px rgb(0 0 0 / 0.7);
    cursor: pointer;
    position: relative;
    transition: transform 0.3s ease;
  }
  .movie-card:hover {
    transform: scale(1.1);
    z-index: 5;
  }
  .movie-card img {
    width: 100%;
    height: 240px;
    object-fit: cover;
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
  }
  .movie-card .movie-info {
    padding: 8px 10px 10px;
  }
  .movie-card .movie-title {
    font-weight: 700;
    font-size: 1rem;
    margin-top: 0;
    color: #fff;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .movie-card .movie-year {
    font-size: 0.85rem;
    color: #bbb;
  }
  /* Scroll Buttons */
  .scroll-btn {
    position: absolute;
    top: 45%;
    width: 45px;
    height: 90px;
    background: linear-gradient(to right, rgba(20,20,20,0.85) 0%, transparent 100%);
    border: none;
    color: #e50914;
    font-size: 2.3rem;
    cursor: pointer;
    z-index: 10;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 0 8px 8px 0;
    transition: background-color 0.3s ease;
  }
  .scroll-btn.left {
    left: 0;
    background: linear-gradient(to left, rgba(20,20,20,0.85) 0%, transparent 100%);
    border-radius: 8px 0 0 8px;
  }
  .scroll-btn:hover {
    background-color: rgba(229, 9, 20, 0.9);
    color: #fff;
  }
  /* Modal for movie detail */
  #modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: rgba(20, 20, 20, 0.95);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
    padding: 20px;
  }
  #modal.open {
    display: flex;
  }
  #modal-content {
    background: #222;
    max-width: 900px;
    width: 100%;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 0 15px #e50914;
    animation: fadeInUp 0.4s ease forwards;
  }
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
  #modal-header {
    position: relative;
    height: 400px;
    background-size: cover;
    background-position: center;
  }
  #modal-close {
    position: absolute;
    top: 15px;
    right: 15px;
    font-size: 2.5rem;
    font-weight: 700;
    color: white;
    cursor: pointer;
    user-select: none;
    text-shadow: 0 0 8px black;
  }
  #modal-body {
    padding: 20px 30px;
    color: #ddd;
  }
  #modal-body h2 {
    margin: 0;
    font-size: 2rem;
    font-weight: 700;
    color: #e50914;
  }
  #modal-body .sub-info {
    margin-top: 8px;
    font-size: 0.95rem;
    color: #bbb;
  }
  #modal-body p {
    margin-top: 12px;
    line-height: 1.5;
    font-size: 1.1rem;
  }
  #modal-body .watch-buttons {
    margin-top: 18px;
  }
  #modal-body button {
    background: #e50914;
    color: #fff;
    border: none;
    padding: 12px 20px;
    font-size: 1rem;
    border-radius: 25px;
    margin-right: 15px;
    cursor: pointer;
    transition: background-color 0.3s;
    user-select: none;
  }
  #modal-body button:hover {
    background-color: #b0070e;
  }
  /* Favorites toggle */
  #modal-body .fav-btn {
    background: transparent;
    border: 2px solid #e50914;
    color: #e50914;
    padding: 10px 18px;
  }
  #modal-body .fav-btn.favorited {
    background: #e50914;
    color: #fff;
  }
  /* Responsive */
  @media screen and (max-width: 768px) {
    nav a {
      margin-left: 15px;
      font-size: 0.85rem;
    }
    #search-input {
      width: 120px;
    }
    #search-input:focus {
      width: 180px;
    }
    .movie-card {
      width: 120px;
    }
    .movie-card img {
      height: 180px;
    }
    #modal-header {
      height: 250px;
    }
    #modal-body h2 {
      font-size: 1.5rem;
    }
    #modal-body p {
      font-size: 1rem;
    }
  }
  @media screen and (max-width: 400px){
    header {
      flex-wrap: wrap;
      height: auto;
      padding: 12px 20px;
    }
    .logo {
      flex-basis: 100%;
      text-align: center;
      margin-bottom: 10px;
    }
    nav {
      flex-basis: 100%;
      justify-content: center;
    }
    #search-container {
      margin-left: 10px;
    }
  }
</style>
</head>
<body>

<!-- Login & Register Overlay -->
<div id="login-overlay" role="dialog" aria-modal="true" aria-labelledby="login-title">
  <div id="login-box">
    <h2 id="login-title">Login to StreamFlix</h2>
    <form id="form-login" aria-label="Login form">
      <input type="text" id="login-username" placeholder="Username" aria-label="Username" autocomplete="username" required />
      <input type="password" id="login-password" placeholder="Password" aria-label="Password" autocomplete="current-password" required />
      <button type="submit" id="login-button">Log In</button>
      <div id="login-error" aria-live="polite"></div>
    </form>
    <form id="form-register" aria-label="Registration form" style="display:none; margin-top: 16px;">
      <input type="text" id="register-username" placeholder="Username" aria-label="Choose username" autocomplete="username" required />
      <input type="password" id="register-password" placeholder="Password" aria-label="Choose password" autocomplete="new-password" required />
      <input type="password" id="register-password-confirm" placeholder="Confirm Password" aria-label="Confirm password" autocomplete="new-password" required />
      <button type="submit" id="register-button">Register</button>
      <div id="register-error" aria-live="polite" style="margin-top: 12px; min-height: 22px; font-weight: 600; color: #ff5252;"></div>
    </form>
    <div id="toggle-form" tabindex="0" role="button" aria-pressed="false" aria-label="Toggle between login and registration forms">
      Don't have an account? Register here.
    </div>
  </div>
</div>

<!-- Main site content -->
<div id="site-content" style="display:none;">

<header>
  <div class="logo">StreamFlix</div>
  <nav>
    <a href="#" data-filter="all">All</a>
    <a href="#" data-filter="movie">Movies</a>
    <a href="#" data-filter="drama">Dramas</a>
    <a href="#" data-filter="new">New</a>
    <div id="search-container">
      <input type="text" id="search-input" placeholder="Search movies & dramas" aria-label="Search movies and dramas" />
    </div>
  </nav>
</header>

<main>
  <h2 class="section-title">Featured</h2>
  <section class="movie-row" id="featured-row">
    <button class="scroll-btn left" aria-label="Scroll left">&#10094;</button>
    <div class="movie-cards" id="featured-cards"></div>
    <button class="scroll-btn right" aria-label="Scroll right">&#10095;</button>
  </section>

  <h2 class="section-title">Trending Movies</h2>
  <section class="movie-row" id="trending-movies-row">
    <button class="scroll-btn left" aria-label="Scroll left">&#10094;</button>
    <div class="movie-cards" id="trending-movies-cards"></div>
    <button class="scroll-btn right" aria-label="Scroll right">&#10095;</button>
  </section>

  <h2 class="section-title">Popular Dramas</h2>
  <section class="movie-row" id="popular-dramas-row">
    <button class="scroll-btn left" aria-label="Scroll left">&#10094;</button>
    <div class="movie-cards" id="popular-dramas-cards"></div>
    <button class="scroll-btn right" aria-label="Scroll right">&#10095;</button>
  </section>

  <h2 class="section-title">New Releases</h2>
  <section class="movie-row" id="new-releases-row">
    <button class="scroll-btn left" aria-label="Scroll left">&#10094;</button>
    <div class="movie-cards" id="new-releases-cards"></div>
    <button class="scroll-btn right" aria-label="Scroll right">&#10095;</button>
  </section>
  
</main>

<div id="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title" aria-describedby="modal-desc">
  <div id="modal-content">
    <div id="modal-header">
      <span id="modal-close" aria-label="Close modal">&times;</span>
    </div>
    <div id="modal-body">
      <h2 id="modal-title"></h2>
      <div class="sub-info" id="modal-sub-info"></div>
      <p id="modal-desc"></p>
      <div class="watch-buttons">
        <button id="watch-trailer-btn">Watch Trailer</button>
        <button id="toggle-fav-btn" class="fav-btn" aria-pressed="false">Add to Favorites</button>
      </div>
    </div>
  </div>
</div>
</div>

<script>
  // Movie Data (Example dataset combining movies and dramas)
  const movies = [
    {
      id: 'm1',
      title: 'The Midnight Sun',
      year: 2023,
      category: 'movie',
      rating: '8.4',
      synopsis: 'A gripping thriller about a secret agent racing against time under the midnight sun.',
      image: 'https://image.tmdb.org/t/p/w500/8UlWHLMpgZm9bx6QYh0NFoq67TZ.jpg',
      trailer: 'https://www.youtube.com/watch?v=FqvtdIegbZ4'
    },
    {
      id: 'm2',
      title: 'Redemption Road',
      year: 2022,
      category: 'movie',
      rating: '7.9',
      synopsis: 'An emotional journey of a man seeking redemption and justice against all odds.',
      image: 'https://image.tmdb.org/t/p/w500/gEU2QniE6E77NI6lCU6MxlNBvIx.jpg',
      trailer: 'https://www.youtube.com/watch?v=lTLF9lNqNqo'
    },
    {
      id: 'd1',
      title: 'Heartstrings',
      year: 2023,
      category: 'drama',
      rating: '9.0',
      synopsis: 'A romantic drama series exploring love, heartbreak, and hope in a modern city.',
      image: 'https://upload.wikimedia.org/wikipedia/en/7/74/Youku_logo.png',
      trailer: 'https://www.youtube.com/watch?v=Z3KN_3-dxIE'
    },
    {
      id: 'd2',
      title: 'City of Shadows',
      year: 2024,
      category: 'drama',
      rating: '8.5',
      synopsis: 'A dark drama about crime, secrets and betrayal set in a mysterious metropolis.',
      image: 'https://image.tmdb.org/t/p/w500/qJ2tW6WMUDux911r6m7haRef0WH.jpg',
      trailer: 'https://www.youtube.com/watch?v=Fz9lGzC9VjQ'
    },
    {
      id: 'm3',
      title: 'Galactic Odyssey',
      year: 2024,
      category: 'movie',
      rating: '8.8',
      synopsis: 'An epic sci-fi adventure across galaxies and unknown worlds.',
      image: 'https://image.tmdb.org/t/p/w500/5KCVkau1HEl7ZzfPsKAPM0sMiKc.jpg',
      trailer: 'https://www.youtube.com/watch?v=JnPTwq2EuZM'
    },
    {
      id: 'd3',
      title: 'Silent Tears',
      year: 2023,
      category: 'drama',
      rating: '8.7',
      synopsis: 'A gripping drama depicting the struggles of a family torn apart by tragedy.',
      image: 'https://image.tmdb.org/t/p/w500/75YShNniHHqlGAdNyFtKfan0s06.jpg',
      trailer: 'https://www.youtube.com/watch?v=PXRyg7vfP28'
    },
    {
      id: 'm4',
      title: 'Crimson Sky',
      year: 2023,
      category: 'movie',
      rating: '8.0',
      synopsis: 'An action-packed thriller high above the clouds with sky pirates and secrets.',
      image: 'https://image.tmdb.org/t/p/w500/jPzAmehsIGliIqZ45t0gCmfalkf.jpg',
      trailer: 'https://www.youtube.com/watch?v=V2xG0T6AL9E'
    },
    {
      id: 'd4',
      title: 'Love in July',
      year: 2024,
      category: 'drama',
      rating: '9.2',
      synopsis: 'A charming summer romance drama filled with laughter, tears and surprises.',
      image: 'https://image.tmdb.org/t/p/w500/m1fFjfNu9WR41j1pq9Lq9MYRpil.jpg',
      trailer: 'https://www.youtube.com/watch?v=CC05j6OSLgI'
    },
    {
      id: 'm5',
      title: 'Legends Never Die',
      year: 2024,
      category: 'movie',
      rating: '9.1',
      synopsis: 'A legendary tale of heroes, battles and the legacy they leave behind.',
      image: 'https://image.tmdb.org/t/p/w500/3INEzPwlY7fkyGDh3UoG9MZz0Ot.jpg',
      trailer: 'https://www.youtube.com/watch?v=bb6zjUwMbKU'
    },
    {
      id: 'd5',
      title: 'Echoes of Time',
      year: 2023,
      category: 'drama',
      rating: '8.6',
      synopsis: 'A mystery drama exploring memories and secrets that transcend time.',
      image: 'https://image.tmdb.org/t/p/w500/fK9HiHtQXTVQflvDUIQRvoWVwKy.jpg',
      trailer: 'https://www.youtube.com/watch?v=04LIQpR_Ozs'
    }
  ];

  // Favorites saved in localStorage using movie IDs list
  let favorites = JSON.parse(localStorage.getItem('favorites')) || [];

  // DOM Elements for movie site
  const featuredCards = document.getElementById('featured-cards');
  const trendingMoviesCards = document.getElementById('trending-movies-cards');
  const popularDramasCards = document.getElementById('popular-dramas-cards');
  const newReleasesCards = document.getElementById('new-releases-cards');
  const searchInput = document.getElementById('search-input');
  const modal = document.getElementById('modal');
  const modalClose = document.getElementById('modal-close');
  const modalTitle = document.getElementById('modal-title');
  const modalSubInfo = document.getElementById('modal-sub-info');
  const modalDesc = document.getElementById('modal-desc');
  const modalHeader = document.getElementById('modal-header');
  const watchTrailerBtn = document.getElementById('watch-trailer-btn');
  const toggleFavBtn = document.getElementById('toggle-fav-btn');
  const navLinks = document.querySelectorAll('nav a[data-filter]');
  const siteContent = document.getElementById('site-content');

  let currentMovie = null;

  // Login & Register elements
  const loginOverlay = document.getElementById('login-overlay');
  const loginBox = document.getElementById('login-box');
  const formLogin = document.getElementById('form-login');
  const formRegister = document.getElementById('form-register');
  const loginError = document.getElementById('login-error');
  const registerError = document.getElementById('register-error');
  const toggleFormBtn = document.getElementById('toggle-form');

  // Utility: Create movie card element
  function createMovieCard(movie) {
    const card = document.createElement('div');
    card.classList.add('movie-card');
    card.setAttribute('tabindex', '0');
    card.setAttribute('role', 'button');
    card.setAttribute('aria-pressed', 'false');
    card.dataset.id = movie.id;

    card.innerHTML = `
      <img src="${movie.image}" alt="${movie.title} poster" loading="lazy" />
      <div class="movie-info">
        <p class="movie-title" title="${movie.title}">${movie.title}</p>
        <p class="movie-year">${movie.year}</p>
      </div>
    `;

    // Click and key event for opening modal
    card.addEventListener('click', () => openModal(movie));
    card.addEventListener('keypress', (e) => {
      if(e.key === 'Enter' || e.key === ' ') {
        e.preventDefault();
        openModal(movie);
      }
    });

    return card;
  }

  // Populate movie rows
  function populateRow(container, movieList) {
    container.innerHTML = '';
    movieList.forEach(movie => {
      container.appendChild(createMovieCard(movie));
    });
  }

  // Filter and sort movies for each category
  function getFeatured() {
    return movies
      .filter(m => parseFloat(m.rating) >= 8.5)
      .sort((a, b) => parseFloat(b.rating) - parseFloat(a.rating))
      .slice(0, 10);
  }

  function getTrendingMovies() {
    return movies
      .filter(m => m.category === 'movie' && m.year >= 2023)
      .slice(0, 10);
  }

  function getPopularDramas() {
    return movies
      .filter(m => m.category === 'drama' && parseFloat(m.rating) >= 8.5)
      .slice(0, 10);
  }

  function getNewReleases() {
    return movies
      .filter(m => m.year === 2024)
      .slice(0, 10);
  }

  // Show modal with movie detail
  function openModal(movie) {
    currentMovie = movie;
    modalTitle.textContent = movie.title;
    modalSubInfo.textContent = `${movie.category.charAt(0).toUpperCase() + movie.category.slice(1)} • ${movie.year} • Rating: ${movie.rating}`;
    modalDesc.textContent = movie.synopsis;
    modalHeader.style.backgroundImage = `url('${movie.image}')`;
    updateFavoriteButton();

    modal.classList.add('open');
    document.body.style.overflow = 'hidden';
    modalClose.focus();
  }

  // Close modal
  function closeModal() {
    modal.classList.remove('open');
    document.body.style.overflow = '';
    currentMovie = null;
  }

  // Watch trailer (open trailer URL in new tab)
  watchTrailerBtn.addEventListener('click', () => {
    if (currentMovie && currentMovie.trailer) {
      window.open(currentMovie.trailer, '_blank', 'noopener');
    }
  });

  // Toggle favorite status for current movie
  toggleFavBtn.addEventListener('click', () => {
    if (!currentMovie) return;
    const idx = favorites.indexOf(currentMovie.id);
    if (idx === -1) {
      favorites.push(currentMovie.id);
    } else {
      favorites.splice(idx, 1);
    }
    localStorage.setItem('favorites', JSON.stringify(favorites));
    updateFavoriteButton();
  });

  // Update favorite button display
  function updateFavoriteButton() {
    if (!currentMovie) return;
    if (favorites.includes(currentMovie.id)) {
      toggleFavBtn.textContent = 'Remove from Favorites';
      toggleFavBtn.classList.add('favorited');
      toggleFavBtn.setAttribute('aria-pressed', 'true');
    } else {
      toggleFavBtn.textContent = 'Add to Favorites';
      toggleFavBtn.classList.remove('favorited');
      toggleFavBtn.setAttribute('aria-pressed', 'false');
    }
  }

  // Close modal on X click and ESC key
  modalClose.addEventListener('click', closeModal);
  window.addEventListener('keydown', (e) => {
    if(e.key === 'Escape' && modal.classList.contains('open')) {
      closeModal();
    }
  });

  // Handle horizontal row scrolling via buttons
  document.querySelectorAll('.movie-row').forEach(row => {
    const container = row.querySelector('.movie-cards');
    const btnLeft = row.querySelector('.scroll-btn.left');
    const btnRight = row.querySelector('.scroll-btn.right');

    btnLeft.addEventListener('click', () => {
      container.scrollBy({ left: -320, behavior: 'smooth' });
    });
    btnRight.addEventListener('click', () => {
      container.scrollBy({ left: 320, behavior: 'smooth' });
    });
  });

  // Search filter for movies and dramas
  searchInput.addEventListener('input', () => {
    const query = searchInput.value.trim().toLowerCase();
    if (!query) {
      loadAllRows();
      return;
    }
    const filtered = movies.filter(m => m.title.toLowerCase().includes(query));
    populateRow(featuredCards, filtered);
    populateRow(trendingMoviesCards, filtered.filter(m => m.category === 'movie'));
    populateRow(popularDramasCards, filtered.filter(m => m.category === 'drama'));
    populateRow(newReleasesCards, filtered.filter(m => m.year === 2024));
  });

  // Nav filter buttons
  navLinks.forEach(link => {
    link.addEventListener('click', e => {
      e.preventDefault();
      const filter = link.dataset.filter;
      searchInput.value = '';
      navLinks.forEach(l => l.style.color = '#fff');
      link.style.color = '#e50914';

      if(filter === 'all') {
        loadAllRows();
      } else if(filter === 'new') {
        populateRow(featuredCards, []);
        populateRow(trendingMoviesCards, []);
        populateRow(popularDramasCards, []);
        populateRow(newReleasesCards, getNewReleases());
      } else {
        const filtered = movies.filter(m => m.category === filter);
        populateRow(featuredCards, []);
        if(filter === 'movie'){
          populateRow(trendingMoviesCards, filtered);
          populateRow(popularDramasCards, []);
          populateRow(newReleasesCards, []);
        } else if(filter === 'drama'){
          populateRow(trendingMoviesCards, []);
          populateRow(popularDramasCards, filtered);
          populateRow(newReleasesCards, []);
        }
      }
    });
  });

  // Initial population
  function loadAllRows() {
    populateRow(featuredCards, getFeatured());
    populateRow(trendingMoviesCards, getTrendingMovies());
    populateRow(popularDramasCards, getPopularDramas());
    populateRow(newReleasesCards, getNewReleases());

    navLinks.forEach(l => {
      if (l.dataset.filter === 'all') {
        l.style.color = '#e50914';
      } else {
        l.style.color = '#fff';
      }
    });
  }

  // User management in localStorage (key: 'streamflix_users')
  // Format: { username1: password1, username2: password2, ... }
  function getUsers() {
    try {
      return JSON.parse(localStorage.getItem('streamflix_users')) || {};
    } catch {
      return {};
    }
  }

  function saveUsers(users) {
    localStorage.setItem('streamflix_users', JSON.stringify(users));
  }

  function isLoggedIn() {
    return localStorage.getItem('streamflix_logged_in') === 'true'
      && localStorage.getItem('streamflix_logged_user');
  }

  function setLoggedIn(username) {
    localStorage.setItem('streamflix_logged_in', 'true');
    localStorage.setItem('streamflix_logged_user', username);
  }

  function logout() {
    localStorage.removeItem('streamflix_logged_in');
    localStorage.removeItem('streamflix_logged_user');
  }

  // Show site or login overlay based on login state
  function showSite() {
    loginOverlay.style.display = 'none';
    siteContent.style.display = '';
    document.body.style.overflow = '';
    loadAllRows();
  }

  function showLogin() {
    loginOverlay.style.display = 'flex';
    siteContent.style.display = 'none';
    document.body.style.overflow = 'hidden';
    // Reset forms
    formLogin.reset();
    formRegister.reset();
    clearErrors();
    showLoginForm();
    document.getElementById('login-username').focus();
  }

  // Toggle between login and register forms
  function showLoginForm() {
    formLogin.style.display = '';
    formRegister.style.display = 'none';
    toggleFormBtn.textContent = "Don't have an account? Register here.";
    toggleFormBtn.setAttribute('aria-pressed', 'false');
    clearErrors();
  }
  function showRegisterForm() {
    formLogin.style.display = 'none';
    formRegister.style.display = '';
    toggleFormBtn.textContent = "Already have an account? Log in here.";
    toggleFormBtn.setAttribute('aria-pressed', 'true');
    clearErrors();
  }

  function clearErrors() {
    loginError.textContent = '';
    registerError.textContent = '';
  }

  // Registration logic
  formRegister.addEventListener('submit', e => {
    e.preventDefault();
    clearErrors();
    const username = document.getElementById('register-username').value.trim();
    const password = document.getElementById('register-password').value;
    const passwordConfirm = document.getElementById('register-password-confirm').value;

    if (!username || !password || !passwordConfirm) {
      registerError.textContent = 'All fields are required.';
      return;
    }
    if (password !== passwordConfirm) {
      registerError.textContent = 'Passwords do not match.';
      return;
    }
    if (password.length < 6) {
      registerError.textContent = 'Password should be at least 6 characters.';
      return;
    }

    const users = getUsers();
    if (users[username]) {
      registerError.textContent = 'Username already exists.';
      return;
    }

    users[username] = password; // Note: storing in plaintext in localStorage, not secure for real apps
    saveUsers(users);
    alert('Registration successful! You can now log in.');
    showLoginForm();
  });

  // Login logic
  formLogin.addEventListener('submit', e => {
    e.preventDefault();
    clearErrors();
    const username = document.getElementById('login-username').value.trim();
    const password = document.getElementById('login-password').value;

    if (!username || !password) {
      loginError.textContent = 'Please enter username and password';
      return;
    }

    const users = getUsers();
    if (!users[username] || users[username] !== password) {
      loginError.textContent = 'Invalid username or password';
      return;
    }

    setLoggedIn(username);
    showSite();
  });

  toggleFormBtn.addEventListener('click', () => {
    if (formLogin.style.display !== 'none') {
      showRegisterForm();
    } else {
      showLoginForm();
    }
  });

  toggleFormBtn.addEventListener('keypress', e => {
    if(e.key === 'Enter' || e.key === ' ') {
      e.preventDefault();
      toggleFormBtn.click();
    }
  });

  // On page load
  window.addEventListener('load', () => {
    if (isLoggedIn()) {
      showSite();
    } else {
      showLogin();
    }
  });
    
</body>
</html>
